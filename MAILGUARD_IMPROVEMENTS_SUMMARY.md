# MailGuard Draft Composition & Sorting - Enhancement Summary

## –û–±–∑–æ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π

### üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ –≤ –º–æ–¥—É–ª–µ MailGuard, –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ—á—Ç—ã.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ SMTP –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

**–§–∞–π–ª:** `app/mailguard/views.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –§—É–Ω–∫—Ü–∏—è `approve_and_send()` —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–¥—É–ª–µ–º `connectors/smtp.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ SMTP —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

**–ö–æ–¥:**
```python
from .connectors.smtp import send_email

success = send_email(
    account=account,
    to_email=draft.to_email,
    subject=draft.subject,
    text_content=draft.body_text or '',
    html_content=draft.body_html,
    attachments=draft.get_attachments()
)
```

---

### 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

**–ù–æ–≤—ã–π endpoint:** `POST /drafts/<draft_id>/edit`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—É –∏ —Ç–µ–∫—Å—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∞–∫–∫–∞—É–Ω—Ç–∞)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–π, —Ç–∞–∫ –∏ HTML –≤–µ—Ä—Å–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
<form method="POST" action="/drafts/{{ draft.id }}/edit">
    <input name="subject" value="{{ draft.subject }}">
    <textarea name="body_text">{{ draft.body_text }}</textarea>
    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</form>
```

---

### 3. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

**–ù–æ–≤—ã–π endpoint:** `POST /drafts/<draft_id>/regenerate`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–ø–∏—Å–∫–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
$.post('/drafts/{{ draft.id }}/regenerate', {
    instructions: '–°–¥–µ–ª–∞–π –æ—Ç–≤–µ—Ç –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º'
}, function(data) {
    window.location.reload();
});
```

---

### 4. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `app/mailguard/mail_analyzer.py`

**–§—É–Ω–∫—Ü–∏—è:** `analyze_message(subject, body_text, from_email)`

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'category': 'invoice|complaint|order|support|inquiry|notification|marketing|other',
    'priority': 'urgent|high|normal|low',
    'sentiment': 'positive|neutral|negative',
    'intent': 'request_info|request_action|provide_info|feedback|other',
    'has_question': True/False,
    'has_attachment_request': True/False,
    'is_automated': True/False,
    'language': 'de|en|unknown',
    'suggested_labels': ['Label1', 'Label2', ...]
}
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**
1. **Invoice** - —Å—á–µ—Ç–∞ –∏ –ø–ª–∞—Ç–µ–∂–∏ (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: Rechnung, invoice, payment, Zahlung)
2. **Complaint** - –∂–∞–ª–æ–±—ã (Beschwerde, complaint, Problem, Fehler)
3. **Order** - –∑–∞–∫–∞–∑—ã (Bestellung, order, Lieferung)
4. **Support** - —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ (support, Hilfe, help)
5. **Inquiry** - –∑–∞–ø—Ä–æ—Å—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (Anfrage, inquiry, Frage)
6. **Notification** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (notification, Benachrichtigung)
7. **Marketing** - –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ (Angebot, offer, Newsletter)
8. **Other** - –æ—Å—Ç–∞–ª—å–Ω–æ–µ

---

### 5. –†–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è AI-–æ—Ç–≤–µ—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `calculate_reply_confidence(message_analysis, thread_length, counterparty_trust, security_status)`

**–§–∞–∫—Ç–æ—Ä—ã, —Å–Ω–∏–∂–∞—é—â–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:**
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: -30%
- üë§ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è –∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é: -20%
- üò† –ù–µ–≥–∞—Ç–∏–≤–Ω–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: -15%
- üì¢ –ñ–∞–ª–æ–±–∞: -20%
- üö® –°—Ä–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: -15%
- üìß –ü–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç: -10%

**–§–∞–∫—Ç–æ—Ä—ã, –ø–æ–≤—ã—à–∞—é—â–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:**
- üí¨ –î–ª–∏–Ω–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ (>3 —Å–æ–æ–±—â–µ–Ω–∏–π): +10%
- ‚≠ê VIP –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: +10%

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```python
confidence = 0.25  # 25% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
reasons = [
    'Sicherheitswarnung',
    'Niedriges Vertrauensniveau',
    'Negative Stimmung',
    'Beschwerde erfordert pers√∂nliche Betreuung',
    'Dringliche Nachricht',
    'Erstkontakt'
]
```

---

### 6. –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–æ—Ç–≤–µ—Ç–æ–≤

**–§–∞–π–ª:** `app/mailguard/nlp_reply.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `mail_analyzer.py`
- –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞
- –î–æ–±–∞–≤–ª–µ–Ω–æ —É–∫–∞–∑–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:**
```
Kontext der Nachrichtenanalyse:
- Kategorie: Beschwerde
- Priorit√§t: URGENT - Bitte zeitnah reagieren
- Stimmung: negativ
- Enth√§lt Fragen - stelle sicher, dass alle beantwortet werden
- Absender erwartet eine Aktion/Handlung
```

---

### 7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

**–§–∞–π–ª:** `app/mailguard/tasks.py`

**–§—É–Ω–∫—Ü–∏—è:** `process_incoming_email()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–∏—Å—å–º–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –≤ `meta_json`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏:**
- Rechnung (—Å—á–µ—Ç–∞)
- Bestellung (–∑–∞–∫–∞–∑—ã)
- Problem (–ø—Ä–æ–±–ª–µ–º—ã)
- Anfrage (–∑–∞–ø—Ä–æ—Å—ã)
- Dringend (—Å—Ä–æ—á–Ω–æ–µ)
- Vertrag (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã)
- Angebot (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)

---

### 8. API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç–∫–∞–º–∏

**–ù–æ–≤—ã–µ endpoints:**

#### –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É
```
POST /messages/<message_id>/label
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: label (string)
–û—Ç–≤–µ—Ç: { "success": true, "labels": ["Label1", "Label2"] }
```

#### –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∫—É
```
POST /messages/<message_id>/unlabel
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: label (string)
–û—Ç–≤–µ—Ç: { "success": true, "labels": ["Label1"] }
```

---

### 9. –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**Endpoint:** `POST /messages/bulk-action`

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**

1. **add_label** - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É –∫–æ –≤—Å–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–º
   ```javascript
   $.post('/messages/bulk-action', {
       message_ids: [1, 2, 3],
       action: 'add_label',
       label: '–í–∞–∂–Ω–æ–µ'
   });
   ```

2. **quarantine** - –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ –∫–∞—Ä–∞–Ω—Ç–∏–Ω
   ```javascript
   $.post('/messages/bulk-action', {
       message_ids: [1, 2, 3],
       action: 'quarantine'
   });
   ```

3. **mark_safe** - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ
   ```javascript
   $.post('/messages/bulk-action', {
       message_ids: [1, 2, 3],
       action: 'mark_safe'
   });
   ```

---

### 10. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ MailDraft

**–§–∞–π–ª:** `app/mailguard/models.py`

**–ù–æ–≤—ã–µ –ø–æ–ª—è:**
- `confidence_score` (Float) - –æ—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ AI (0-1)
- `meta_json` (Text) - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø—Ä–∏—á–∏–Ω—ã

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `get_meta()` - –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- `set_meta(meta)` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `migrations/versions/a9b2e8f1d3c7_add_confidence_score_and_meta_to_mail_.py`

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –ê–Ω–∞–ª–∏–∑ —Å—á–µ—Ç–∞
```
–¢–µ–º–∞: Rechnung f√ºr Bestellung #12345
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: invoice ‚úì
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: normal ‚úì
–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: neutral ‚úì
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏: Rechnung, Bestellung ‚úì
```

### –¢–µ—Å—Ç 2: –°—Ä–æ—á–Ω–∞—è –∂–∞–ª–æ–±–∞
```
–¢–µ–º–∞: DRINGEND: Problem mit Lieferung!!!
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: complaint ‚úì
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: urgent ‚úì
–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: negative ‚úì
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏: Problem, Dringend ‚úì
```

### –¢–µ—Å—Ç 3: –†–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
```
–°—Ü–µ–Ω–∞—Ä–∏–π: –ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç, —Å—Ä–æ—á–Ω–∞—è –∂–∞–ª–æ–±–∞, –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ
–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 0.00% ‚úì (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ —Ç—Ä–µ–±—É—é—â–µ–µ —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
–ü—Ä–∏—á–∏–Ω—ã: 6 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Å–Ω–∏–∂–µ–Ω–∏—è ‚úì
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- Flask
- SQLAlchemy
- OpenAI API (gpt-4o-mini)
- PostgreSQL

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
# –¢—Ä–µ–±—É–µ—Ç—Å—è –≤ .env
OPENAI_API_KEY=sk-...
DATABASE_URL=postgresql://...
DB_SCHEMA=vat_verification
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
app/mailguard/
‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª–∏ –ë–î (—Ä–∞—Å—à–∏—Ä–µ–Ω–∞ MailDraft)
‚îú‚îÄ‚îÄ views.py            # –ù–æ–≤—ã–µ endpoints (edit, regenerate, label, bulk)
‚îú‚îÄ‚îÄ tasks.py            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
‚îú‚îÄ‚îÄ nlp_reply.py        # –£–ª—É—á—à–µ–Ω–Ω–∞—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ mail_analyzer.py    # –ù–û–í–´–ô: –ú–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ connectors/
    ‚îî‚îÄ‚îÄ smtp.py         # –û—Ç–ø—Ä–∞–≤–∫–∞ email

migrations/versions/
‚îî‚îÄ‚îÄ a9b2e8f1d3c7_...py  # –ù–û–í–ê–Ø: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è MailDraft
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ª—É—á—à–µ–Ω–∏–π

1. **–¢–æ—á–Ω–æ—Å—Ç—å AI-–æ—Ç–≤–µ—Ç–æ–≤** ‚Üë
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∏—Å—å–º–∞
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–æ–Ω–∞ –∫ —Ç–∏–ø—É –∑–∞–ø—Ä–æ—Å–∞
   - –£—á–µ—Ç —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

2. **–°–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫** ‚Üì
   - –û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã
   - –ñ–∞–ª–æ–±—ã –∏ —Å—Ä–æ—á–Ω—ã–µ –ø–∏—Å—å–º–∞ —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Üë
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –º–µ—Ç–∫–∞–º
   - –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Üë
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É AI –Ω–µ —É–≤–µ—Ä–µ–Ω
   - –í–∏–¥–∏–º–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```python
# –í—Ö–æ–¥—è—â–µ–µ –ø–∏—Å—å–º–æ
Subject: Anfrage: Produktdetails
Body: K√∂nnen Sie mir bitte Informationen √ºber XYZ senden?

# –ê–Ω–∞–ª–∏–∑
category: inquiry
priority: normal
sentiment: neutral
has_question: True
confidence: 0.75 (–≤—ã—Å–æ–∫–∞—è)

# AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### –ü—Ä–∏–º–µ—Ä 2: –ñ–∞–ª–æ–±–∞ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
```python
# –í—Ö–æ–¥—è—â–µ–µ –ø–∏—Å—å–º–æ
Subject: DRINGEND: Problem!!!
Body: Ich bin sehr unzufrieden...

# –ê–Ω–∞–ª–∏–∑
category: complaint
priority: urgent
sentiment: negative
confidence: 0.0 (–Ω–∏–∑–∫–∞—è)

# –ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
```

### –ü—Ä–∏–º–µ—Ä 3: –ú–∞—Å—Å–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–∏—Å—å–º–∞ —Å –º–µ—Ç–∫–æ–π "Rechnung"
// –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –º–µ—Ç–∫—É "Q1-2026"
$('.message-checkbox:checked').each(function() {
    selected_ids.push($(this).val());
});

$.post('/messages/bulk-action', {
    message_ids: selected_ids,
    action: 'add_label',
    label: 'Q1-2026'
});
```

---

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **Machine Learning –º–æ–¥–µ–ª—å**
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö/–æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
   - –£–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ –ø–∏—Å–µ–º
   - –°–≤—è–∑—å —Å —Å–¥–µ–ª–∫–∞–º–∏ –∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏

3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –î–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
   - –û—Ç—á–µ—Ç—ã –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

4. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —è–∑—ã–∫–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```python
# –í mail_analyzer.py
def detect_category(subject: str, body_text: str) -> str:
    # ...
    new_category_keywords = ['keyword1', 'keyword2']
    if any(keyword in text for keyword in new_category_keywords):
        return 'new_category'
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
```python
# –í mail_analyzer.py -> calculate_reply_confidence()
if message_analysis.get('custom_factor'):
    confidence -= 0.25  # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ
    reasons.append('Custom reason')
```

---

## ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å MailGuard –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω:
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ AI-–æ—Ç–≤–µ—Ç—ã —Å—Ç–∞–ª–∏ —É–º–Ω–µ–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è
- ‚úÖ –û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production.**

---

**–î–∞—Ç–∞:** 30 —è–Ω–≤–∞—Ä—è 2026  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–í–µ—Ä—Å–∏—è:** 2.0
