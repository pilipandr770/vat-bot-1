#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ Render.com
# –ó–∞–ø—É—Å–∫–∞—Ç—å –≤ Render Shell

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π..."
echo ""

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
echo "üìä –¢–µ–∫—É—â–∞—è —Ä–µ–≤–∏–∑–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:"
flask db current || echo "–û—à–∏–±–∫–∞: –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞"
echo ""

# –ü–æ–∫–∞–∑–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—É—é —Ä–µ–≤–∏–∑–∏—é
echo "üìã –û–∂–∏–¥–∞–µ–º–∞—è —Ä–µ–≤–∏–∑–∏—è (–∏–∑ –∫–æ–¥–∞):"
flask db heads
echo ""

# –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å stamp –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
echo "üî® –ü–æ–ø—ã—Ç–∫–∞ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é..."
flask db stamp 361def0cfaed
if [ $? -eq 0 ]; then
    echo "‚úÖ –£—Å–ø–µ—à–Ω–æ! –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏..."
    flask db upgrade
    if [ $? -eq 0 ]; then
        echo "üéâ –ú–∏–≥—Ä–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!"
        flask db current
        exit 0
    fi
fi

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ï—Å–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 1 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º stamp head
echo ""
echo "üî® –ü–æ–ø—ã—Ç–∫–∞ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é (stamp head)..."
flask db stamp head
if [ $? -eq 0 ]; then
    echo "‚úÖ –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!"
    echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –±–∞–∑–µ"
    flask db current
    exit 0
fi

# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ
echo ""
echo "‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å."
echo "üìû –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:"
echo "   1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É alembic_version: SELECT * FROM alembic_version;"
echo "   2. –£–¥–∞–ª–∏—Ç–µ –Ω–µ–≤–µ—Ä–Ω—É—é —Ä–µ–≤–∏–∑–∏—é: DELETE FROM alembic_version WHERE version_num = '6191a483e0ab';"
echo "   3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: flask db stamp head"
exit 1
