# MailGuard - –í–∞—Ä—ñ–∞–Ω—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Email

## üìß –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω (—â–æ –ø—Ä–∞—Ü—é—î):

### ‚úÖ IMAP/SMTP –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ (email + password)
- **–§–∞–π–ª–∏**: `app/mailguard/connectors/imap.py`, `smtp.py`
- **–§–æ—Ä–º–∞**: `/mailguard/accounts/add-imap`
- **–ë–µ–∑–ø–µ–∫–∞**: –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ (Fernet)
- **–ü—ñ–¥—Ç—Ä–∏–º–∞–Ω—ñ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏**: Gmail, Outlook, Yahoo, Mail.ru, Yandex, Custom

### ‚úÖ OAuth 2.0 (Gmail, Microsoft)
- **–§–∞–π–ª–∏**: `app/mailguard/oauth.py`, `connectors/gmail.py`, `microsoft.py`
- **–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å**: –í–∏—Å–æ–∫–∞ (–ø–æ—Ç—Ä—ñ–±–Ω—ñ API keys, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ Google/Microsoft Console)
- **–ü–µ—Ä–µ–≤–∞–≥–∏**: –ë–µ–∑–ø–µ—á–Ω—ñ—à–µ, –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–∞—Ä–æ–ª—å

---

## üöÄ –ù–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è (—â–æ–π–Ω–æ –¥–æ–¥–∞–Ω–æ):

### 1. **Email Presets** - —Å–ø—Ä–æ—â–µ–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
**–§–∞–π–ª**: `app/mailguard/presets.py`

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–æ—Å—Ç–æ –æ–±–∏—Ä–∞—î —Å–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Gmail, Outlook, Yahoo, Mail.ru, Yandex) - –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è IMAP/SMTP –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ!

**–Ø–∫ –ø—Ä–∞—Ü—é—î**:
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É "Gmail"
2. –§–æ—Ä–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è:
   - IMAP: `imap.gmail.com:993`
   - SMTP: `smtp.gmail.com:587`
3. –ü–æ–∫–∞–∑—É—é—Ç—å—Å—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ App Password
4. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–≤–æ–¥–∏—Ç—å —Ç—ñ–ª—å–∫–∏ email + App Password

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚ùå –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ API keys
- ‚ùå –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–∫–ª–∞–¥–Ω—ñ OAuth –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- ‚úÖ –ü—Ä–∞—Ü—é—î –≤—ñ–¥—Ä–∞–∑—É
- ‚úÖ –ë–µ–∑–ø–µ—á–Ω–æ (App Passwords)

---

## üîÆ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ (–Ω–∞ –º–∞–π–±—É—Ç–Ω—î):

### –í–∞—Ä—ñ–∞–Ω—Ç 1: **–í–ª–∞—Å–Ω–∏–π Email –°–µ—Ä–≤–µ—Ä –≤ Docker** üê≥

**–Ü–¥–µ—è**: –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ Postfix + Dovecot –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```yaml
# docker-compose.yml
services:
  mailserver:
    image: docker-mailserver/docker-mailserver:latest
    hostname: mail.example.com
    ports:
      - "25:25"    # SMTP
      - "587:587"  # SMTP Submission
      - "993:993"  # IMAPS
    volumes:
      - ./mail-data:/var/mail
      - ./mail-state:/var/mail-state
    environment:
      - ENABLE_SPAMASSASSIN=1
      - ENABLE_CLAMAV=1
      - ENABLE_FAIL2BAN=1
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- ‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- ‚úÖ –ú–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–µ–æ–±–º–µ–∂–µ–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–∫–∞—É–Ω—Ç—ñ–≤

**–ù–µ–¥–æ–ª—ñ–∫–∏**:
- ‚ùå –°–∫–ª–∞–¥–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ DNS (SPF, DKIM, DMARC)
- ‚ùå IP –º–æ–∂–µ –±—É—Ç–∏ –≤ blacklist
- ‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ–º–µ–Ω
- ‚ùå –ù–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è production

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**: –¢—ñ–ª—å–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è/—Ä–æ–∑—Ä–æ–±–∫–∏

---

### –í–∞—Ä—ñ–∞–Ω—Ç 2: **Transactional Email Service** üì®

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä–∏**: SendGrid, Mailgun, AWS SES, Postmark

```python
# –ü—Ä–∏–∫–ª–∞–¥ SendGrid
import sendgrid
from sendgrid.helpers.mail import Mail

def send_via_sendgrid(api_key, to_email, subject, content):
    sg = sendgrid.SendGridAPIClient(api_key)
    message = Mail(
        from_email='noreply@yourdomain.com',
        to_emails=to_email,
        subject=subject,
        html_content=content
    )
    response = sg.send(message)
    return response.status_code == 202
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ –í–∏—Å–æ–∫–∏–π deliverability rate
- ‚úÖ –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ–≤/–∫–ª—ñ–∫—ñ–≤
- ‚úÖ API –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
- ‚úÖ Free tier: 100 emails/day (SendGrid)

**–ù–µ–¥–æ–ª—ñ–∫–∏**:
- ‚ùå –¢—ñ–ª—å–∫–∏ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ (SendGrid), –Ω–µ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
- ‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ–º–µ–Ω –¥–ª—è production
- ‚ùå –ü–ª–∞—Ç–Ω–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**: –î–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ AI-generated replies, –Ω–µ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è

---

### –í–∞—Ä—ñ–∞–Ω—Ç 3: **MCP Email Server** (Model Context Protocol)

**–Ü–¥–µ—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ MCP –¥–ª—è email –æ–ø–µ—Ä–∞—Ü—ñ–π

```python
# mcp_email_server.py
from mcp.server import Server
from mcp.types import Resource, Tool

class EmailMCPServer(Server):
    async def list_resources(self):
        return [
            Resource(
                uri="email://inbox",
                name="Email Inbox",
                mime_type="application/json"
            )
        ]
    
    async def call_tool(self, name, arguments):
        if name == "send_email":
            return await self.send_email(**arguments)
        elif name == "fetch_emails":
            return await self.fetch_emails(**arguments)
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ú–æ–∂–Ω–∞ –º—ñ–∫—Å—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏
- ‚úÖ Claude/AI –º–æ–∂—É—Ç—å –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ email

**–ù–µ–¥–æ–ª—ñ–∫–∏**:
- ‚ùå MCP —â–µ –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ (beta)
- ‚ùå –û–±–º–µ–∂–µ–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ email –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤
- ‚ùå Overhead –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –∑–∞–¥–∞—á

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**: –Ø–∫—â–æ —ñ–Ω—Ç–µ–≥—Ä—É—î—à –∑ Claude Desktop –∞–±–æ AI agents

---

### –í–∞—Ä—ñ–∞–Ω—Ç 4: **Email Forwarding Service** üìÆ

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä–∏**: Cloudflare Email Routing (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ!), ImprovMX

**–Ø–∫ –ø—Ä–∞—Ü—é—î**:
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î email –Ω–∞ —Å–≤–æ—î–º—É –¥–æ–º–µ–Ω—ñ: `mailguard@mydomain.com`
2. –ù–∞–ª–∞—à—Ç–æ–≤—É—î forwarding –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –ø–æ—à—Ç–æ–≤—É —Å–∫—Ä–∏–Ω—å–∫—É
3. MailGuard –æ—Ç—Ä–∏–º—É—î –ø–æ—à—Ç—É —á–µ—Ä–µ–∑ IMAP –∑ forwarded –∞–¥—Ä–µ—Å–∏
4. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —á–µ—Ä–µ–∑ SMTP –∑ —Ä–µ–∞–ª—å–Ω–æ—ó –∞–¥—Ä–µ—Å–∏

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (Cloudflare)
- ‚úÖ –ü—Ä–æ—Å—Ç–∏–π setup
- ‚úÖ –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –≤–∏–≥–ª—è–¥ (@mydomain.com)

**–ù–µ–¥–æ–ª—ñ–∫–∏**:
- ‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ–º–µ–Ω
- ‚ùå –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –∫—Ä–æ–∫ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

### –î–ª—è production (–∑–∞—Ä–∞–∑):
**‚úÖ IMAP/SMTP –∑ Email Presets** - –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ —ñ –ø—Ä–∞—Ü—é—î –≤—ñ–¥—Ä–∞–∑—É!

### –î–ª—è enterprise:
1. **Transactional Email** (SendGrid/Mailgun) –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
2. **IMAP** –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
3. **Cloudflare Email Routing** –¥–ª—è custom domains

### –î–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏/—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
1. **Gmail/Outlook** –∑ App Passwords (—á–µ—Ä–µ–∑ presets)
2. **Mailtrap.io** (fake SMTP –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

### –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è:
- ‚ùå –í–ª–∞—Å–Ω–∏–π email —Å–µ—Ä–≤–µ—Ä (–Ω–∞–¥—Ç–æ —Å–∫–ª–∞–¥–Ω–æ)
- ‚ùå OAuth 2.0 (–∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è:

| –í–∞—Ä—ñ–∞–Ω—Ç | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –í–∞—Ä—Ç—ñ—Å—Ç—å | –®–≤–∏–¥–∫—ñ—Å—Ç—å setup | Production-ready |
|---------|------------|----------|-----------------|------------------|
| **IMAP + Presets** | üü¢ –ù–∏–∑—å–∫–∞ | üü¢ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | üü¢ 2 —Ö–≤ | ‚úÖ –¢–∞–∫ |
| OAuth 2.0 | üî¥ –í–∏—Å–æ–∫–∞ | üü¢ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | üî¥ 30 —Ö–≤ | ‚úÖ –¢–∞–∫ |
| Docker Mail | üî¥ –í–∏—Å–æ–∫–∞ | üü¢ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | üü° 1 –≥–æ–¥ | ‚ùå –ù—ñ (—Ç—ñ–ª—å–∫–∏ dev) |
| SendGrid | üü° –°–µ—Ä–µ–¥–Ω—è | üü° $0-15/–º—ñ—Å | üü¢ 10 —Ö–≤ | ‚úÖ –¢–∞–∫ |
| Cloudflare Email | üü¢ –ù–∏–∑—å–∫–∞ | üü¢ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | üü° 15 —Ö–≤ | ‚úÖ –¢–∞–∫ |
| MCP Server | üî¥ –í–∏—Å–æ–∫–∞ | üü¢ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | üî¥ 2 –≥–æ–¥ | ‚ùå Beta |

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

1. ‚úÖ **–î–æ–¥–∞–Ω–æ Email Presets** - –≥–æ—Ç–æ–≤–æ!
2. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
3. ‚è≥ –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é (background job)
4. ‚è≥ –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∑ VirusTotal –¥–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
5. ‚è≥ –î–æ–¥–∞—Ç–∏ AI-–≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π

---

**–í–∏—Å–Ω–æ–≤–æ–∫**: IMAP/SMTP –∑ Email Presets - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç! –ü—Ä–æ—Å—Ç–∏–π –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –±–µ–∑–ø–µ—á–Ω–∏–π, –ø—Ä–∞—Ü—é—î –∑ –±—É–¥—å-—è–∫–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º. üéâ
