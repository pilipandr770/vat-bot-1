{% extends "base.html" %}

{% block title %}DSGVO-Anfrage - VAT Verification System{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="text-center mb-5">
                <i class="bi bi-shield-check text-primary" style="font-size: 4rem;"></i>
                <h1 class="mt-3">DSGVO-Anfrage stellen</h1>
                <p class="lead text-muted">Ihre Rechte nach der Datenschutz-Grundverordnung</p>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle"></i> Ihre Rechte nach DSGVO
                    </h5>
                </div>
                <div class="card-body">
                    <p>Gemäß der EU-Datenschutz-Grundverordnung (DSGVO) haben Sie folgende Rechte:</p>
                    <ul>
                        <li><strong>Art. 15 DSGVO - Auskunftsrecht:</strong> Sie können Auskunft über Ihre gespeicherten Daten verlangen</li>
                        <li><strong>Art. 16 DSGVO - Recht auf Berichtigung:</strong> Sie können die Korrektur fehlerhafter Daten verlangen</li>
                        <li><strong>Art. 17 DSGVO - Recht auf Löschung:</strong> Sie können die Löschung Ihrer Daten verlangen</li>
                        <li><strong>Art. 18 DSGVO - Recht auf Einschränkung:</strong> Sie können die Einschränkung der Verarbeitung verlangen</li>
                        <li><strong>Art. 20 DSGVO - Datenübertragbarkeit:</strong> Sie können Ihre Daten in einem strukturierten Format erhalten</li>
                        <li><strong>Art. 21 DSGVO - Widerspruchsrecht:</strong> Sie können der Verarbeitung widersprechen</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Anfrageformular</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('legal.gdpr_request') }}">
                        <div class="mb-3">
                            <label for="email" class="form-label">
                                <i class="bi bi-envelope"></i> E-Mail-Adresse *
                            </label>
                            <input 
                                type="email" 
                                class="form-control" 
                                id="email" 
                                name="email" 
                                required
                                placeholder="ihre@email.de"
                                {% if current_user.is_authenticated %}value="{{ current_user.email }}"{% endif %}>
                            <small class="form-text text-muted">
                                Wir benötigen Ihre E-Mail, um Sie zu identifizieren und Ihnen zu antworten
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="request_type" class="form-label">
                                <i class="bi bi-list-check"></i> Art der Anfrage *
                            </label>
                            <select class="form-select" id="request_type" name="request_type" required>
                                <option value="">Bitte wählen...</option>
                                <option value="auskunft">Auskunft (Art. 15 DSGVO) - Welche Daten sind gespeichert?</option>
                                <option value="berichtigung">Berichtigung (Art. 16 DSGVO) - Daten korrigieren</option>
                                <option value="loeschung">Löschung (Art. 17 DSGVO) - Daten löschen</option>
                                <option value="einschraenkung">Einschränkung (Art. 18 DSGVO) - Verarbeitung einschränken</option>
                                <option value="uebertragbarkeit">Datenübertragbarkeit (Art. 20 DSGVO) - Daten exportieren</option>
                                <option value="widerspruch">Widerspruch (Art. 21 DSGVO) - Der Verarbeitung widersprechen</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="message" class="form-label">
                                <i class="bi bi-chat-left-text"></i> Ihre Nachricht
                            </label>
                            <textarea 
                                class="form-control" 
                                id="message" 
                                name="message" 
                                rows="5"
                                placeholder="Bitte beschreiben Sie Ihre Anfrage im Detail..."></textarea>
                        </div>

                        <div class="alert alert-info">
                            <h6 class="alert-heading">
                                <i class="bi bi-clock"></i> Bearbeitungszeit
                            </h6>
                            <p class="mb-0">
                                Gemäß Art. 12 Abs. 3 DSGVO werden wir Ihre Anfrage innerhalb von <strong>30 Tagen</strong> 
                                beantworten. In komplexen Fällen kann diese Frist um weitere 60 Tage verlängert werden, 
                                worüber wir Sie informieren würden.
                            </p>
                        </div>

                        <div class="form-check mb-3">
                            <input 
                                class="form-check-input" 
                                type="checkbox" 
                                id="confirmIdentity" 
                                required>
                            <label class="form-check-label" for="confirmIdentity">
                                Ich bestätige, dass ich die betroffene Person bin oder deren bevollmächtigter Vertreter. 
                                Mir ist bewusst, dass eine Identitätsprüfung erforderlich sein kann.
                            </label>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-send"></i> Anfrage absenden
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-person-badge"></i> Schnelle Löschung
                            </h5>
                            <p class="card-text">
                                Wenn Sie angemeldet sind, können Sie Ihr Konto und alle Daten direkt selbst löschen.
                            </p>
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('legal.delete_account') }}" class="btn btn-danger">
                                <i class="bi bi-trash"></i> Konto jetzt löschen
                            </a>
                            {% else %}
                            <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary">
                                <i class="bi bi-box-arrow-in-right"></i> Anmelden
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-envelope"></i> Direkter Kontakt
                            </h5>
                            <p class="card-text">
                                Sie können uns auch direkt per E-Mail kontaktieren:
                            </p>
                            <a href="mailto:andrii.it.info@gmail.com" class="btn btn-outline-primary">
                                <i class="bi bi-envelope"></i> E-Mail senden
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-question-circle"></i> Häufig gestellte Fragen
                    </h5>
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="faq1">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                                    Wie lange dauert die Bearbeitung meiner Anfrage?
                                </button>
                            </h2>
                            <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Gemäß DSGVO Art. 12 Abs. 3 werden wir innerhalb von 30 Tagen antworten. 
                                    In komplexen Fällen kann diese Frist um weitere 60 Tage verlängert werden.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="faq2">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                                    Muss ich meine Identität nachweisen?
                                </button>
                            </h2>
                            <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Ja, gemäß DSGVO Art. 12 Abs. 6 können wir angemessene Maßnahmen zur Identitätsfeststellung 
                                    verlangen, um die Rechte und Freiheiten anderer Personen zu schützen.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="faq3">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                                    Kostet die Anfrage etwas?
                                </button>
                            </h2>
                            <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Nein, die Bearbeitung Ihrer Anfrage ist grundsätzlich kostenlos (DSGVO Art. 12 Abs. 5). 
                                    Nur bei offenkundig unbegründeten oder exzessiven Anfragen können wir eine Gebühr verlangen.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-5">
                <p class="text-muted">
                    <small>
                        <i class="bi bi-shield-check"></i> Alle Anfragen werden vertraulich behandelt und gemäß DSGVO bearbeitet
                    </small>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
