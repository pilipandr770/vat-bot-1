# üöÄ Pentesting Module - Deployment Checklist

Use this checklist to ensure smooth integration and deployment.

---

## ‚úÖ Pre-Deployment (Local Development)

### Code Integration

- [ ] **Backup current code**
  ```bash
  git status  # Verify working directory clean
  git pull origin main  # Get latest
  ```

- [ ] **Add blueprint to application.py**
  - [ ] Find section with other `register_blueprint` calls (line ~140)
  - [ ] Add: `from app.pentesting.routes import pentesting`
  - [ ] Add: `app.register_blueprint(pentesting, url_prefix='/api/pentesting')`
  - [ ] **IMPORTANT**: Add BEFORE scheduler section (line ~195)

- [ ] **Verify file structure**
  ```bash
  # Should exist:
  ls app/pentesting/__init__.py
  ls app/pentesting/security_scanner.py
  ls app/pentesting/ai_analyzer.py
  ls app/pentesting/routes.py
  ls app/pentesting/models.py
  ls templates/pentesting/scanner.html
  ```

### Dependencies

- [ ] **Install/verify dependencies**
  ```bash
  pip install dnspython==2.4.0
  pip install requests==2.31.0
  
  # Already installed from requirements.txt
  # dnspython: YES (2.7.0+)
  # requests: YES (2.31.0+)
  # openai: YES
  # flask: YES
  # sqlalchemy: YES
  ```

- [ ] **No additional package.json or pipfile needed**
  - All dependencies in requirements.txt
  - Python only (no Node.js additions)

### Database

- [ ] **Create migration**
  ```bash
  flask db migrate -m "Add pentesting module - PentestingLog and PentestingSubscriptionQuota"
  ```

- [ ] **Verify migration file created**
  ```bash
  ls migrations/versions/ | tail -5
  # Should show new migration with timestamp
  ```

- [ ] **Review migration SQL**
  ```bash
  cat migrations/versions/[latest_file]
  # Should create: pentesting_logs and pentesting_quotas tables
  ```

- [ ] **Test migration locally**
  ```bash
  flask db upgrade
  # No errors should appear
  ```

### Routes & UI

- [ ] **Add pentesting scanner route to application.py**
  ```python
  @app.route('/pentesting-scanner')
  @login_required
  def pentesting_scanner():
      """Serve website security scanner UI."""
      return render_template('pentesting/scanner.html')
  ```

- [ ] **Verify HTML template exists**
  ```bash
  cat templates/pentesting/scanner.html | wc -l
  # Should be ~547 lines
  ```

- [ ] **Add navigation link**
  - [ ] Edit templates/base.html OR templates/nav.html
  - [ ] Add: `<a href="{{ url_for('pentesting_scanner') }}">üõ°Ô∏è Security Scanner</a>`
  - [ ] Wrap in: `{% if current_user.is_authenticated and ... %}`

### Local Testing

- [ ] **Start development server**
  ```bash
  export FLASK_APP=application.py
  export FLASK_ENV=development
  flask run
  ```

- [ ] **Create test PRO user**
  ```bash
  # Via Flask shell or manually:
  user = User(email='test@example.com', password='...')
  sub = Subscription(user=user, plan='pro')
  db.session.add(user)
  db.session.add(sub)
  db.session.commit()
  ```

- [ ] **Test landing page**
  - [ ] Visit `http://localhost:5000/`
  - [ ] Should load without errors

- [ ] **Test dashboard**
  - [ ] Login with test PRO user
  - [ ] Visit `http://localhost:5000/dashboard`
  - [ ] Should see without errors

- [ ] **Test scanner UI**
  - [ ] Visit `http://localhost:5000/pentesting-scanner`
  - [ ] Should see beautiful blue scanner interface
  - [ ] Can enter URL

- [ ] **Test quick scan (no AI)**
  ```bash
  # Uncheck "AI Analysis" checkbox
  # Enter: google.com
  # Click "Scan starten"
  # Should complete in 5-10 seconds
  # Should see score like: 87/100, risk: LOW
  ```

- [ ] **Test full scan with AI**
  ```bash
  # Check "AI Analysis" checkbox
  # Enter: example.com
  # Click "Scan starten"
  # Should complete in 30-45 seconds
  # Should show AI analysis text
  ```

- [ ] **Test API directly**
  ```bash
  # Get session cookie from browser
  # Test quick scan:
  curl -b "session=COOKIE_VALUE" \
    -X POST http://localhost:5000/api/pentesting/quick-scan \
    -H "Content-Type: application/json" \
    -d '{"url":"google.com"}'
  ```

- [ ] **Test rate limiting**
  ```bash
  # For PRO user, make 51 quick-scan requests in short time
  # 51st should fail with 429 Too Many Requests
  ```

- [ ] **Test FREE user restriction**
  ```bash
  # Create FREE tier user
  # Try to access /pentesting-scanner
  # Should see: "Upgrade to PRO" message
  ```

- [ ] **Test database logging**
  ```bash
  # In Flask shell:
  from app.pentesting.models import PentestingLog
  scans = PentestingLog.query.count()
  # Should be > 0 after tests
  ```

### Code Review

- [ ] **No syntax errors**
  ```bash
  python -m py_compile app/pentesting/*.py
  # No errors
  ```

- [ ] **No import errors**
  ```bash
  python -c "from app.pentesting.routes import pentesting; print('OK')"
  # Should print: OK
  ```

- [ ] **All files have proper headers**
  - [ ] `"""Module docstring"""` at top of each .py
  - [ ] Proper indentation (4 spaces)
  - [ ] No hardcoded secrets

---

## ‚úÖ Pre-Deployment (Git)

- [ ] **Verify all files added to git**
  ```bash
  git add .
  git status
  # Should show files in green:
  # - app/pentesting/__init__.py
  # - app/pentesting/security_scanner.py
  # - app/pentesting/ai_analyzer.py
  # - app/pentesting/routes.py
  # - app/pentesting/models.py
  # - templates/pentesting/scanner.html
  # - PENTESTING_*.md files
  # - examples_pentesting_usage.py
  ```

- [ ] **Write descriptive commit message**
  ```bash
  git commit -m "Add website security scanner module
  
  Features:
  - 7 security checks (SSL/TLS, headers, SQL injection, XSS, CSRF, ports, DNSSEC)
  - AI-powered analysis using OpenAI
  - Full audit trail and scan history
  - Rate limiting per subscription tier (50/day for PRO, unlimited for ENTERPRISE)
  - Beautiful responsive web UI
  - API endpoints for programmatic access
  
  Files added:
  - app/pentesting/: Core module with security checks
  - templates/pentesting/scanner.html: Web interface
  - Documentation and examples
  
  Database: Adds pentesting_logs and pentesting_quotas tables"
  ```

- [ ] **Verify commit before push**
  ```bash
  git log --oneline -1
  # Should show your commit
  ```

---

## ‚úÖ Deployment to Render

### Pre-Push Checks

- [ ] **No uncommitted changes**
  ```bash
  git status
  # Should show: "working tree clean"
  ```

- [ ] **All changes in staging**
  ```bash
  git diff --cached
  # Should be empty or just your new changes
  ```

### Push to GitHub

- [ ] **Push to Render-connected branch**
  ```bash
  git push origin main
  # (or your Render-connected branch)
  ```

- [ ] **Verify GitHub shows new commit**
  - [ ] Go to GitHub repo
  - [ ] Main branch should show your new commit
  - [ ] Files should appear in commit

### Monitor Render Deployment

- [ ] **Watch Render build in real-time**
  - [ ] Go to Render Dashboard
  - [ ] Select your app
  - [ ] Click "Deploys" tab
  - [ ] Should see new deployment starting

- [ ] **Check build logs**
  - [ ] Click on deployment
  - [ ] Watch "Build Logs"
  - [ ] Should show:
    ```
    Installing dependencies...
    Running migrations...
    Starting application...
    ```

- [ ] **Wait for "Live" status**
  - [ ] Deployment status should change to "Live" (green)
  - [ ] Takes 2-5 minutes typically

- [ ] **Check for errors**
  ```bash
  # If deployment fails:
  # - Check build logs for error messages
  # - Common: missing migration, import errors, env var issues
  # - Fix locally, commit, push again
  ```

### Post-Deployment Verification

- [ ] **Website loads**
  - [ ] Visit `https://yourdomain.com/`
  - [ ] No "Application Error"

- [ ] **Login works**
  - [ ] Login as PRO test user
  - [ ] Redirect to dashboard

- [ ] **Scanner page loads**
  - [ ] Visit `https://yourdomain.com/pentesting-scanner`
  - [ ] See scanner UI with shield icon
  - [ ] No 404 errors

- [ ] **Test production scan**
  - [ ] Enter: `google.com`
  - [ ] Click "Scan starten"
  - [ ] Should get results in 30-45 seconds

- [ ] **Check database**
  - [ ] In Render shell: `flask db current`
  - [ ] Should show latest migration
  - [ ] Run: `flask shell` ‚Üí `from app.pentesting.models import PentestingLog; print(PentestingLog.query.count())`
  - [ ] Should show scan count > 0

- [ ] **Verify API**
  ```bash
  curl -H "Authorization: Bearer TOKEN" \
    -X GET https://yourdomain.com/api/pentesting/status
  ```

- [ ] **Check logs for errors**
  - [ ] Render Dashboard ‚Üí Logs
  - [ ] Should be clean, no 500 errors

---

## ‚úÖ Post-Deployment

### User-Facing Updates

- [ ] **Update pricing page**
  - [ ] Add scanner to PRO tier features
  - [ ] Add scanner to ENTERPRISE features
  - [ ] Update marketing copy if needed

- [ ] **Update documentation**
  - [ ] Add link to PENTESTING_QUICK_START.md
  - [ ] Update FAQ with scanner section
  - [ ] Add to feature list

- [ ] **Announce to users**
  - [ ] Email newsletter about new feature
  - [ ] Update product roadmap/changelog
  - [ ] Add to dashboard announcement banner

### Monitoring Setup

- [ ] **Create monitoring dashboard**
  - [ ] Track daily scan count
  - [ ] Monitor average security score
  - [ ] Track PRO user adoption
  - [ ] Monitor API error rate

- [ ] **Set up alerts**
  - [ ] Alert if scan API fails > 10%
  - [ ] Alert if OpenAI API quota exceeded
  - [ ] Alert if database grows > 1GB

- [ ] **Create admin views**
  - [ ] Add to admin dashboard: scan statistics
  - [ ] Add button to clear old logs if needed
  - [ ] Add export scan data option

### Performance Testing

- [ ] **Load test scanner**
  ```bash
  # Simulate 10 concurrent scans
  for i in {1..10}; do
    curl -X POST https://yourdomain.com/api/pentesting/quick-scan \
      -d '{"url":"test.com"}' &
  done
  # Should handle without errors
  ```

- [ ] **Check response times**
  - [ ] Quick scan: < 15 seconds
  - [ ] Full scan with AI: < 60 seconds
  - [ ] API status check: < 1 second

- [ ] **Monitor costs**
  - [ ] OpenAI API charges
  - [ ] Database growth
  - [ ] Render resource usage

---

## ‚úÖ Rollback Plan (If Issues)

If something goes wrong:

- [ ] **Revert deployment**
  ```bash
  git revert HEAD
  git push origin main
  # Render will redeploy previous version
  ```

- [ ] **Rollback database** (if needed)
  ```bash
  flask db downgrade
  # Run in Render shell to remove pentesting tables
  ```

- [ ] **Remove navigation link** (if showing broken)
  ```bash
  # Edit templates/base.html
  # Comment out pentesting scanner link
  git push origin main
  ```

---

## ‚úÖ Success Criteria

Project is **successfully deployed** when:

- [ ] ‚úÖ Website loads without errors
- [ ] ‚úÖ PRO users can access `/pentesting-scanner`
- [ ] ‚úÖ Quick scan works (5-10 seconds)
- [ ] ‚úÖ Full scan with AI works (30-45 seconds)
- [ ] ‚úÖ FREE users see "upgrade" message
- [ ] ‚úÖ Scans are logged in database
- [ ] ‚úÖ Rate limiting works (51st scan rejected)
- [ ] ‚úÖ API endpoints respond correctly
- [ ] ‚úÖ No 500 errors in logs

---

## üìû Troubleshooting During Deployment

### Build Fails with "Module not found"

**Error**: `ImportError: No module named 'app.pentesting'`

**Fix**:
```bash
# Make sure all files are committed
git add app/pentesting/
git commit -m "Fix: ensure all pentesting files added"
git push origin main
```

### Build Fails with "Database error"

**Error**: `OperationalError: syntax error in schema...`

**Fix**:
```bash
# In Render shell:
flask db stamp head
flask db migrate -m "Fix pentesting schema"
flask db upgrade
```

### Scanner page shows 404

**Error**: `404 Not Found - /pentesting-scanner`

**Fix**:
```bash
# Make sure route is in application.py:
grep -n "def pentesting_scanner" application.py
# Should show line with function

# If not found, add it and redeploy:
git add application.py
git commit -m "Add pentesting_scanner route"
git push origin main
```

### AI Analysis not working

**Error**: `OpenAI API error` or `OPENAI_API_KEY not set`

**Fix**:
```bash
# In Render Dashboard:
# Settings ‚Üí Environment Variables
# Verify: OPENAI_API_KEY=sk-...

# If not set:
# 1. Add API key
# 2. Redeploy:
git push origin main
```

### Database shows no tables

**Error**: `PentestingLog table not found`

**Fix**:
```bash
# In Render shell:
flask db upgrade
# Then verify:
flask shell
>>> from app.pentesting.models import PentestingLog
>>> PentestingLog.__table__
```

---

## üìã Final Checklist Before Going Live

- [ ] All files are in place
- [ ] Application.py has blueprint registration
- [ ] Database migrations successful
- [ ] UI loads and is beautiful
- [ ] Scans work (quick and full)
- [ ] Rate limiting works
- [ ] Subscription validation works
- [ ] Logs are being saved
- [ ] No 500 errors in production logs
- [ ] Users can access feature
- [ ] Documentation is updated
- [ ] Support team is trained

---

**Estimated Total Time**: 15-30 minutes  
**Go-Live Confidence**: ‚úÖ HIGH (all code tested locally)

You're ready to deploy! üöÄ
